version: '3.8'

services:
  resource-monitor:
    build: .
    container_name: resource-monitor
    restart: unless-stopped
    # Required for accurate system metrics
    privileged: true
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
    environment:
      - TZ=${TZ:-UTC}
      # Telegram configuration
      # If TELEGRAM_TOKEN is empty, runs in console mode
      # If TELEGRAM_TOKEN is set, requires CHAT_ID and optionally uses INTERVAL_MINUTES
      - TELEGRAM_ARG=${TELEGRAM_TOKEN:+--telegram ${TELEGRAM_TOKEN}}
      - CHAT_ARG=${TELEGRAM_TOKEN:+--chat ${CHAT_ID}}
      - INTERVAL_ARG=${TELEGRAM_TOKEN:+--interval ${INTERVAL_MINUTES:-60}}
    # Pass command-line arguments conditionally based on mode
    command: dotnet ResourceMonitorCli.dll ${TELEGRAM_ARG} ${CHAT_ARG} ${INTERVAL_ARG}
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
